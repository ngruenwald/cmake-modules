include(external.cmake)

set(EXT_VERSION "3.6.0")
set(EXT_URL_HASH "SHA256=f1ca9ab7a80c5caec9c2e06604a2f13910458dd6a59d3bdb620385fe3b8c49d5")

ExternalProject_Add(
  ext_libarchive
  UPDATE_DISCONNECTED true
  URL https://github.com/libarchive/libarchive/archive/refs/tags/v${EXT_VERSION}.zip
  URL_HASH ${EXT_URL_HASH}
  CMAKE_ARGS
    -D CMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
    -D CMAKE_PREFIX_PATH=${EXTERNAL_INSTALL_LOCATION}
    -D CMAKE_INSTALL_PREFIX=${EXTERNAL_INSTALL_LOCATION}

    -D ENABLE_MBEDTLS=OFF
    -D ENABLE_NETTLE=OFF
    -D ENABLE_OPENSSL=OFF

    -D ENABLE_LIBB2=OFF
    -D ENABLE_LZ4=OFF
    -D ENABLE_LZO=OFF
    -D ENABLE_LZMA=ON
    -D ENABLE_ZSTD=OFF
    -D ENABLE_ZLIB=ON
    -D ENABLE_BZip2=OFF
    -D ENABLE_LIBXML2=OFF
    -D ENABLE_EXPAT=OFF
    -D ENABLE_PCREPOSIX=OFF
    -D ENABLE_LibGCC=OFF
    -D ENABLE_CNG=ON

    -D ENABLE_TAR=OFF
    -D ENABLE_TAR_SHARED=OFF
    -D ENABLE_CPIO=OFF
    -D ENABLE_CPIO_SHARED=OFF
    -D ENABLE_CAT=OFF
    -D ENABLE_CAT_SHARED=OFF

    -D ENABLE_XATTR=ON
    -D ENABLE_ACL=ON
    -D ENABLE_ICONV=ON

    -D ENABLE_TEST=OFF
    -D ENABLE_COVERAGE=OFF
    -D ENABLE_INSTALL=ON
)

add_dependencies(contrib ext_libarchive)
